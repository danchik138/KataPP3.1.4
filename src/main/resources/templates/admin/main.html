<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>


<div class="container-fluid bg-dark overflow-hidden text-white">
    <div class="row">
        <div class="col-3 p-1 align-self-start">
            <span th:text="${currentUser.getEmail()}"></span>
            <span>with roles:</span>
            <span th:each="role : ${currentUser.getRoles()}" th:text="${role.getShortName()} +' '"> </span>
          </div>
          <div class="col"></div>
          <div class="col-3 p-1 align-self-end d-flex justify-content-end">
            <form id="logout" th:method="post" th:action="@{../logout}"></form>
            <button form="logout" type="submit" class="btn btn-dark text-white">Logout</button>
          </div>
    </div>
    
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-2 nav flex-column nav-pills my-2" aria-orientation="vertical">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Admin</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../user">User</a>
              </li>
        </div>
        <div class="col">
            <h1>Admin panel</h1>
            <div>
                <ul class="nav nav-tabs" id="usersTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="true">Users table</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" id="create-tab" data-bs-toggle="tab" data-bs-target="#create" type="button" role="tab" aria-controls="create" aria-selected="false">New user</button>
                    </li>
                </ul>
                <div class="tab-content" id="usersTabsContent">
                    <div class="tab-pane fade show active" id="users" role="tabpanel" aria-labelledby="users-tab">
                        <div class="card">
                            <div class="card-header">
                                <h3>All users</h3>
                            </div>
                            <div class="card-body">
                                <table class="table table-striped border-top">
                                    <thead>
                                        <th>Id</th>
                                        <th>Login</th>
                                        <th>Email</th>
                                        <th>First name</th>
                                        <th>Last name</th>
                                        <th>Age</th>
                                        <th>Roles</th>
                                        <th>Edit</th>
                                        <th>Delete</th>
                                    </thead>
                                    <tbody>
                                        <tr th:each="currentUser : ${users}">
                                            <td th:text="${currentUser.getId()}"></td>
                                            <td th:text="${currentUser.getLogin()}"></td>
                                            <td th:text="${currentUser.getEmail()}"></td>
                                            <td th:text="${currentUser.getFirstName()}"></td>
                                            <td th:text="${currentUser.getLastName()}"></td>
                                            <td th:text="${currentUser.getAge()}"></td>
                                            <td>
                                                <th:block th:each="role : ${currentUser.getRoles()}">
                                                <span th:text="${role.getShortName()}"></span>
                                                <span> </span>
                                                </th:block>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-info text-white" data-bs-toggle="modal" th:data-bs-target="${'#editUser' + currentUser.getId()}">
                                                  Edit
                                                </button>
                                                <div class="modal fade" th:id="${'editUser' + currentUser.getId()}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                                                  <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" id="editModalLabel">Edit user</h4>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form th:method="patch" th:action="@{/admin/update}" th:object="${user}" autocomplete="off" th:id="${'updateForm' + currentUser.getId()}">
                                                                <label class="d-block">ID
                                                                    <input  th:value="${currentUser.id}" type="number" disabled class="form-control"></label>
                                                                <input th:name="id" th:value="${currentUser.id}" th:errorclass="fieldError" type="hidden">
                                                                <label class="form-label">Login
                                                                    <input th:name="login" th:value="${currentUser.login}" th:errorclass="fieldError" required="" type="text" class="form-control"></label>
                                                                <label class="form-label">Email
                                                                    <input th:name="email" th:value="${currentUser.email}" th:errorclass="fieldError" required="" type="email" class="form-control"></label>
                                                                <label class="form-label">First Name
                                                                    <input th:name="firstName" th:value="${currentUser.firstName}" th:errorclass="fieldError" type="text" class="form-control"></label>
                                                                <label class="form-label">Last Name
                                                                    <input th:name="lastName" th:value="${currentUser.lastName}" th:errorclass="fieldError" type="text" class="form-control"></label>
                                                                <label class="form-label">Age
                                                                    <input th:name="age" min="0" max="127" th:value="${currentUser.age}" th:errorclass="fieldError" type="number" class="form-control"></label>
                                                                <label class="form-label">Password
                                                                    <input th:name="password" type="text" class="form-control" th:errorclass="fieldError" placeholder="type new password"></label>
                                                                <label class="form-label">Role
                                                                    <select size="2" multiple required class="form-select" aria-label="Default select" name="role">
                                                                        <option value="ROLE_ADMIN">ADMIN</option>
                                                                        <option value="ROLE_USER" selected="selected">USER</option>
                                                                    </select></label>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary fs-5" data-bs-dismiss="modal">Close</button>
                                                        <input type="submit" th:form="${'updateForm' + currentUser.id}" class="btn btn-primary fs-5" value="Edit">
                                                        </div>
                                                    </div>
                                                  </div>
                                                </div>
                                                <!--/* end edit modal window */-->
                                              </td>
                                            <td>
                                                <form th:method="DELETE" th:action="@{/admin/delete}">
                                                    <input type="hidden" name = "id" th:value="${currentUser.getId()}">
                                                    <input type="submit" class="btn btn-danger" value="Delete">
                                                </form>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="create" role="tabpanel" aria-labelledby="create-tab">
                        <div class="card">
                            <div class="card-header">
                                <h3>Add new user</h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                <div class="col-4"></div>
                                <div class="col-4">
                                <form th:method="post" th:action="@{/admin/create}" th:object="${user}">
                                    <label for="saveLogin" class="form-label d-block text-center fw-bold">Login</label>
                                    <input type="text" class="form-control" required th:filed="*{login}" name="login" id="saveLogin"><br>
                                    <label for="saveEmail" class="form-label d-block text-center fw-bold">Email</label>
                                    <input type="email" class="form-control" required th:filed="*{email}" name="email" id="saveEmail"><br>
                                    <label for="savePassword" class="form-label d-block text-center fw-bold">Password</label>
                                    <input type="password" class="form-control" required th:filed="*{password}" name="password" id="savePassword"><br>
                                    <label for="savePassword" class="form-label d-block text-center fw-bold">First name</label>
                                    <input type="text" class="form-control" th:filed="*{firstName}" name="firstName" id="saveFirstName"><br>
                                    <label for="saveLastName" class="form-label d-block text-center fw-bold">Last name</label>
                                    <input type="text" class="form-control" th:filed="*{lastName}" name="lastName" id="saveLastName"><br>
                                    <label for="saveAge" class="form-label d-block text-center fw-bold">Age</label>
                                    <input type="number" class="form-control" required th:filed="*{age}" value="0" name="age" id="saveAge"><br>
                                    <label for="saveRole" class="form-label d-block text-center fw-bold">Roles</label>
                                    <select size="2" multiple required class="form-select" aria-label="Default select" name="role" id="saveRole">
                                        <option value="ROLE_ADMIN">ADMIN</option>
                                        <option value="ROLE_USER" selected="selected">USER</option>
                                    </select>
                                    <div class="d-flex justify-content-center">
                                        <input type="submit" class="btn btn-success mt-4" value="Add new user">
                                    </div>
                                </form>
                                </div>
                                <div class="col-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div> <!--Delete all-->
                <form th:method="delete" id="deleteAll" th:action="@{admin/deleteAll}">
                    <input type="submit" class="btn btn-danger" value="Delete All Users">
                </form>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>